<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= importRecord.fileName || 'Import Details' %> - ImportSDK Metrics</title>
    <link href="https://cdn.jsdelivr.net/npm/daisyui@4.4.19/dist/full.min.css" rel="stylesheet" type="text/css" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .fade-in { animation: fadeIn 0.6s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="bg-base-100 min-h-screen">
    <!-- Navigation -->
    <div class="navbar bg-base-100 shadow-lg border-b border-base-200">
        <div class="flex-1">
            <a href="/" class="btn btn-ghost normal-case text-xl">
                <div class="w-8 h-8 gradient-bg rounded-lg flex items-center justify-center text-white font-bold mr-2">üìä</div>
                ImportSDK Metrics
            </a>
        </div>
        <div class="flex-none">
            <ul class="menu menu-horizontal px-1">
                <li><a href="/">Dashboard</a></li>
                <li><a href="/imports">Imports</a></li>
                <li><a href="/logs">Logs</a></li>
            </ul>
        </div>
    </div>

    <main class="container mx-auto px-4 py-6 max-w-7xl">
        <div class="fade-in">
            <!-- Page Header -->
            <div class="mb-8">
                <div class="breadcrumbs text-sm mb-4">
                    <ul>
                        <li><a href="/">Dashboard</a></li>
                        <li><a href="/imports">Imports</a></li>
                        <li class="text-base-content/70"><%= importRecord.fileName || 'Unknown File' %></li>
                    </ul>
                </div>
                
                <div class="flex items-start justify-between">
                    <div>
                        <h1 class="text-4xl font-bold text-base-content mb-2">
                            üìÑ <%= importRecord.fileName || 'Unknown File' %>
                        </h1>
                        <p class="text-base-content/70 text-lg mb-4">
                            Import completed on <%= new Date(importRecord.timestamp).toLocaleString() %>
                        </p>
                        <div class="flex gap-2">
                            <div class="badge badge-outline">ID: <%= importRecord.id %></div>
                            <% if (importRecord.sessionId) { %>
                                <div class="badge badge-outline">Session: <%= importRecord.sessionId %></div>
                            <% } %>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Summary Cards -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <!-- Processing Summary -->
                <div class="card bg-base-100 shadow-lg">
                    <div class="card-body">
                        <h3 class="card-title text-lg">üìä Processing Summary</h3>
                        <div class="space-y-2">
                            <div class="flex justify-between">
                                <span class="text-base-content/70">Total Rows:</span>
                                <span class="font-semibold"><%= (importRecord.stats && importRecord.stats.totalCount || 0).toLocaleString() %></span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-base-content/70">Success:</span>
                                <span class="text-success font-semibold"><%= (importRecord.stats && importRecord.stats.successCount || 0).toLocaleString() %></span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-base-content/70">Errors:</span>
                                <span class="text-error font-semibold"><%= (importRecord.stats && importRecord.stats.errorCount || 0).toLocaleString() %></span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-base-content/70">Filtered:</span>
                                <span class="text-warning font-semibold"><%= (importRecord.stats && importRecord.stats.filteredCount || 0).toLocaleString() %></span>
                            </div>
                        </div>
                        <div class="divider my-2"></div>
                        <div class="flex justify-between font-bold">
                            <span>Success Rate:</span>
                            <span class="text-success">
                                <%= (((importRecord.stats && importRecord.stats.successCount || 0) / Math.max(1, importRecord.stats && importRecord.stats.totalCount || 1)) * 100).toFixed(1) %>%
                            </span>
                        </div>
                    </div>
                </div>

                <!-- Performance Metrics -->
                <div class="card bg-base-100 shadow-lg">
                    <div class="card-body">
                        <h3 class="card-title text-lg">‚ö° Performance</h3>
                        <div class="space-y-2">
                            <div class="flex justify-between">
                                <span class="text-base-content/70">Duration:</span>
                                <span class="font-semibold">
                                    <%= ((importRecord.metrics && importRecord.metrics.totalDurationSeconds || 0) < 60 ? 
                                        (importRecord.metrics && importRecord.metrics.totalDurationSeconds || 0).toFixed(1) + 's' : 
                                        Math.floor((importRecord.metrics && importRecord.metrics.totalDurationSeconds || 0) / 60) + 'm ' + 
                                        ((importRecord.metrics && importRecord.metrics.totalDurationSeconds || 0) % 60).toFixed(0) + 's') %>
                                </span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-base-content/70">Throughput:</span>
                                <span class="text-accent font-semibold"><%= (importRecord.metrics && importRecord.metrics.rowsPerSecond || 0).toFixed(1) %> rows/s</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-base-content/70">Efficiency:</span>
                                <span class="font-semibold"><%= (importRecord.metrics && importRecord.metrics.efficiency || 0).toFixed(1) %>%</span>
                            </div>
                            <% if (importRecord.metrics && importRecord.metrics.performanceScore) { %>
                                <div class="flex justify-between">
                                    <span class="text-base-content/70">Score:</span>
                                    <span class="font-semibold"><%= Math.round(importRecord.metrics.performanceScore) %></span>
                                </div>
                            <% } %>
                        </div>
                    </div>
                </div>

                <!-- Resource Usage -->
                <div class="card bg-base-100 shadow-lg">
                    <div class="card-body">
                        <h3 class="card-title text-lg">üíæ Resource Usage</h3>
                        <div class="space-y-2">
                            <% if (importRecord.metrics && importRecord.metrics.fileSize) { %>
                                <div class="flex justify-between">
                                    <span class="text-base-content/70">File Size:</span>
                                    <span class="font-semibold">
                                        <%= (importRecord.metrics.fileSize / 1024 / 1024).toFixed(1) %>MB
                                    </span>
                                </div>
                            <% } %>
                            <% if (importRecord.metrics && importRecord.metrics.memoryUsageEstimate) { %>
                                <div class="flex justify-between">
                                    <span class="text-base-content/70">Memory:</span>
                                    <span class="font-semibold">
                                        <%= (importRecord.metrics.memoryUsageEstimate / 1024 / 1024).toFixed(1) %>MB
                                    </span>
                                </div>
                            <% } %>
                            <% if (importRecord.metrics && importRecord.metrics.cpuLoadEstimate) { %>
                                <div class="flex justify-between">
                                    <span class="text-base-content/70">CPU Load:</span>
                                    <span class="font-semibold"><%= importRecord.metrics.cpuLoadEstimate.toFixed(1) %>%</span>
                                </div>
                            <% } %>
                        </div>
                    </div>
                </div>

                <!-- API Statistics -->
                <div class="card bg-base-100 shadow-lg">
                    <div class="card-body">
                        <h3 class="card-title text-lg">üåê API Statistics</h3>
                        <div class="space-y-2">
                            <% if (importRecord.metrics && importRecord.metrics.apiCalls) { %>
                                <div class="flex justify-between">
                                    <span class="text-base-content/70">API Calls:</span>
                                    <span class="font-semibold"><%= importRecord.metrics.apiCalls %></span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-base-content/70">Avg Latency:</span>
                                    <span class="font-semibold"><%= (importRecord.metrics.avgApiLatency || 0).toFixed(0) %>ms</span>
                                </div>
                            <% } else { %>
                                <div class="text-center text-base-content/50 py-4">
                                    No API statistics available
                                </div>
                            <% } %>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Bottlenecks -->
            <% if (importRecord.metrics && importRecord.metrics.bottlenecks && importRecord.metrics.bottlenecks.length > 0) { %>
                <div class="card bg-base-100 shadow-lg mb-8">
                    <div class="card-body">
                        <h3 class="card-title mb-4">üö® Performance Bottlenecks</h3>
                        <div class="space-y-3">
                            <% importRecord.metrics.bottlenecks.forEach(function(bottleneck) { %>
                                <div class="alert alert-warning">
                                    <div class="flex-1">
                                        <span class="font-medium"><%= bottleneck %></span>
                                    </div>
                                </div>
                            <% }); %>
                        </div>
                    </div>
                </div>
            <% } %>

            <!-- Import Logs -->
            <% if (logs && logs.length > 0) { %>
                <div class="card bg-base-100 shadow-lg mb-8">
                    <div class="card-body">
                        <h3 class="card-title mb-4">üìã Import Logs</h3>
                        <div class="space-y-2 max-h-96 overflow-y-auto">
                            <% logs.forEach(function(log) { %>
                                <div class="flex items-start gap-3 p-3 bg-base-200 rounded-lg">
                                    <div class="badge badge-sm mt-1 <%= log.level === 'error' ? 'badge-error' : log.level === 'warning' ? 'badge-warning' : log.level === 'success' ? 'badge-success' : 'badge-info' %>">
                                        <%= log.level %>
                                    </div>
                                    <div class="flex-1">
                                        <div class="font-medium text-sm"><%= log.message %></div>
                                        <div class="text-xs text-base-content/60 mt-1">
                                            <%= new Date(log.timestamp).toLocaleString() %>
                                        </div>
                                    </div>
                                </div>
                            <% }); %>
                        </div>
                    </div>
                </div>
            <% } %>
        </div>
    </main>

    <script>
        // Auto-refresh every 30 seconds
        setTimeout(() => {
            window.location.reload();
        }, 30000);
    </script>
</body>
</html>